# SQL
SQL, or Structured Query Language, is a declarative (focused on defining outcomes over procedure) domain-specific (focused on one job) programming language used to command relational databases.

## Terminology

**RDBMS** 
- Relational Database Management System, relational referring to relational data (i.e. tables).


**Table**
- A collection of related data held in a table format within a database. 
- It consists of columns and rows.


**Column**
- a set of data values of a particular simple type, one value for each row of the database 
- Also known as "attributes"


**Row**
- Represents a single, implicitly structured data item in a table
- Also known as "records" or "tuples"


**Schema** 
- Similar packages/namespaces, groupings of tables expressing some database logical structure.


**SQL dialects** 
- Though SQL is an ANSI-standardized language, its specification is defined in such a way that RDBMS vendors (such as PostGreSQL, Oracle, etc.) are


**Primary Key** 
- Unique (in that table), non-null candidate key.


**Surrogate Key**
- A column that represents a value that only has meaning within the context of the containing database (i.e. an autogenerated number/string used for an ID)


**Natural Key**
- A column that represents a natural value that has meaning beyond the context of the containing database and can be used to uniquely identify a row (or entry).

- Also known as a **candidate key**


**Composite Key** 
- A primary key consisting of multiple columns, the combination of their values being used to determine uniqueness.


**Foreign Key** 
- A column whose value represents the a unique identifier (typically a primary key) that refers to records within either in another table, or the same.


**Multiplicity** 
- A concepts the describes the minimum and maximum number of relationships between linked tables.
- Examples: 

  - One-to-One (1:1)
    - 1 Course has 1 Instructor
    - Usually facilitated through the use of a lookup table
    - Can also be represented by referencing another record in the same table

  - One-to-Many (1:N)
    - 1 Course has N Students
    - 1 Student takes N Courses
    - Can be represented by referencing another record of another table

  - Many-to-Many (N:N)
    - N Courses have N Students
    - Can only be properly represented through the use of a junction table


**Referential Integrity** 
- The concept of enforcing data relationships.
- No orphaned records!


**ERD** 
- Entity-Relational Diagram
- A diagrammatic representation of your database schema and the multiplicities between its tables.


**Alias** The `AS` or `IS` keyword allows you to set a Table name or column name as a short variable.


**Normalization** 
- The concept of dividing data into separate tables to reduce redundancy and improve query speed
- The degree to which we normalize our database is measured by our compliance to the Normal Forms (NF).
- We usually only need to comply with 3NF, though there a ~7 Normal Forms in total.

### Example schema with no normalization
| SalesStaff |
| --- |
| EmployeeID |
| SalesPerson |
| SalesOffice |
| Age |
| DOB |
| Customer1 |
| Customer2 |
| Customer3 |

### 1st Normal Form (Atomic values, No repeating Columns)
| SalesStaff |
| --- |
| EmployeeID |
| SalesPersonName |
| Age |
| DOB |
| SalesOfficeStreet |
| SalesOfficeCity |
| SalesOfficeState |
| SalesOfficeZip |

| Customer |
| --- |
| CustomerId |
| EmployeeId |
| CustomerName |

### 2nd NF (Remove Partial Dependencies)
| SalesStaff |
| --- |
| EmployeeID |
| SalesPersonName |
| Age |
| DOB |
| SalesOfficeID |

| SalesOffice |
| --- |
| SalesOfficeId |
| SalesOfficeStreet |
| SalesOfficeCity |
| SalesOfficeState |
| SalesOfficeZip |

| Customer |
| --- |
| CustomerId |
| EmployeeId |
| CustomerName |

### 3rd NF (Remove Transitive Dependencies)
| SalesStaff |
| --- |
| EmployeeID |
| SalesPersonName |
| DOB |
| SalesOfficeID |

| SalesOffice |
| --- |
| SalesOfficeId |
| SalesOfficeStreet |
| SalesOfficeZip |

| Customer |
| --- |
| CustomerId |
| EmployeeId |
| CustomerName |

## SQL Sublanguages
**DCL** Data Control Language, setting user permissions (GRANT, REVOKE)

**DDL** Data Definition Language, working with database structure (CREATE, ALTER, TRUNCATE, DROP) EX:
```
CREATE TABLE (Schema)[TableName]
(Column definitions (Constraints))


ALTER TABLE [TableName]
ADD (Column) [Column definition]
ADD (Constraint clause)
DROP [column] [cascade]
DROP Constraint
ALTER COLUMN [definition]
```

**DML** Data Manipulation Language, working with the rows of data itself (INSERT, UPDATE, DELETE) EX:
```
INSERT INTO [TableName] [columns]
VALUES (data input)
SELECT (drop entire result set into table)
```

**DQL** Data Query Language, retrieving rows of data (SELECT). EX:
```
SELECT [columnList]
FROM [tableList]
WHERE [conditionList]
GROUP BY [columnList] // aggregate functions
HAVING [condition]  // aggregate functions
ORDER BY [columnList]
```

**TCL** Transaction Control Language, managing transactions (COMMIT, ROLLBACK, SAVEPOINT)
```
BEGIN;
SAVEPOINT this_point;
INSERT ...
INSERT ...
INSERT ... --Error here
ROLLBACK TO SAVEPOINT this_point; --Undo last 3 inserts
INSERT ...
COMMIT; --Only last insert will commit
```

## Joins
Combine rows from two tables based on some logical relationship between them (columns)
### Types
1. Inner Join, selects records with matching values from TableA and TableB
1. Left (Outer) Join, TableA primary, selects all records from A with matching values from B (non-matching values included as null)
1. Right (Outer) Join, TableB is primary, opposte of Left Join.
1. Cross Join, Cartesian join of two tables, if TableA has 5 rows, and TableB has 3 rows, the cross join will have 15 rows
1. Subquery is a query nested in the WHERE clause of a SELECT statement, in orde3r to further restrict the data returned. There are correlated and non-correlated. Correlated subqueries depend on the outer query to exist, meaning they cannot execute independently.

## Unions
1. UNION returns distinct rows present in either return set
1. UNION ALL returns all rows in both sets (including duplicates)
1. INTERSECT returns distinct rows present in both sets
1. EXCEPT returns all rows present in first set but not in second

## Functions
**Sequences** Generate numeric sequence, mostl for creating/managing primary keys.

**Views** Virtual table that displays the results of a SELECT statement, lets you reuse and store complex queries

**Indexes** Physical ordering of a column or group of columns, having unique indexes

**Aggregate Functions** (AVG, MIN, MAX, SUM, COUNT) perform an action on an entire column

**Scalar functions** (LOWER, UPPER) operate on individual entries

**Functions** Custom function with 0 or many input parameters, but 0 or 1 output. DML is not allowed.

**Stored Procedures** Custom function with 0 or many input parameters, but 0 or many output parameters. DML allowed.
